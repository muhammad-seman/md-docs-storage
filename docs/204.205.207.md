# CSMS Dashboard - Implementation Summary

## Overview
Implementasi 3 dashboard baru untuk monitoring dan analytics kendaraan listrik (EV) di sistem CSMS (Charging Station Management System). Semua dashboard menggunakan **dummy data** untuk development dan testing, siap di-swap dengan real API ketika backend sudah ready.

---

## Ticket 1: EV Battery Monitoring Dashboard

### 1. Deskripsi Story Ticket
**Story:**
> As an admin, I want to view a real-time dashboard showing key electric vehicle metrics like SOC, SOH, RPM, speed, and PTO status, so I can monitor unit performance and battery health across XCMG and HOWO fleets.

**Expected Results:**
- Real-time graphs of SOC over time, SOH (battery health trend), RPM and speed, PTO status on/off
- Battery temp / voltage / capacity (if available)
- Filters: Per unit, per fleet, or per partner
- Time window selector (last 15m, 1hr, 1 day)
- Show status indicators (e.g., "SOH drop 3% in 1 week")
- Must support both XCMG and HOWO brands

### 2. Motivasi Stakeholder
**Kebutuhan bisnis:**
- **Proactive Monitoring:** Monitoring team perlu tahu kondisi battery real-time untuk intervensi dini sebelum SOC critical atau SOH degradasi parah
- **Fleet Health Overview:** Admin perlu lihat status semua unit secara sekilas tanpa harus cek satu-satu
- **Brand Comparison:** Perlu membandingkan performa XCMG vs HOWO untuk evaluasi procurement
- **Early Warning System:** Detect anomali (SOH drop signifikan, temperature tinggi, dll) sebelum unit breakdown

**Use Case:**
> Monitoring team buka dashboard pagi hari → lihat EV-612 SOC 15% (critical), SOH 88% (dropping 3% per week) → segera schedule charging & inspection

### 3. Solusi yang Dibuat

**Route:** `/csms/dashboard/ev-monitoring`

**Komponen Utama:**

#### A. Main View - DataGrid Table
- **Columns:**
  - Unit Number (dengan battery icon sesuai SOC level)
  - Brand, Fleet, Partner, Location
  - Status (idle/in_journey/charging)
  - SOC & SOH (progress bar dengan color-coding)
  - Speed (CAN), RPM, PTO Status, Battery Temp
  - Alert count (jika ada warning/error)
  - Action button (View Details)

#### B. Filter System
- **Brand:** All, XCMG, HOWO
- **Fleet:** All, Fleet A, Fleet B, Fleet C
- **Partner:** All, Partner 1, 2, 3
- **Status:** All, idle, in_journey, charging
- Auto-refresh (30 detik) + manual refresh button
- Last update timestamp

#### C. Summary Cards
- Total Units
- In Journey count
- Charging count
- Critical SOC (<20%) count

#### D. Detail Modal (Click View Details)
- **Battery Metrics Card:** SOC, SOH (with progress bars), Voltage, Current, Temperature, Capacity
- **Vehicle Metrics Card:** Speed CAN/GPS, RPM, PTO Status
- **SOC Trend Chart:** Line chart 24 jam (hourly data)
- **SOH Trend Chart:** Weekly trend (4 weeks)
- **Alerts Panel:** Warning/Error messages dengan timestamp + recommendations

**Data File:** `data/evMonitoringData.js`
- 5 EV units (mix XCMG & HOWO)
- Complete metrics per unit
- SOC trend (15 data points - hourly)
- SOH trend (4 data points - weekly)
- Alert system (SOH drop, critical SOC, PTO anomalies)

### 4. Alasan Design

**Why Table View (bukan Cards):**
- Stakeholder butuh **quick scan** banyak unit sekaligus
- Table memudahkan sorting & filtering
- Progress bar langsung di table → instant visual status
- Lebih scalable (50+ units tetap readable)

**Why Detail Modal (bukan inline charts):**
- Chart butuh space → modal fullscreen lebih nyaman
- Tidak slow down main table load
- Fokus analysis per unit tanpa distraksi
- Charts responsive & lebih besar

**Why Color-Coding:**
- SOC: Green (>80%), Blue (50-80%), Yellow (20-50%), Red (<20%)
- SOH: Green (>90%), Yellow (80-90%), Red (<80%)
- Instant visual cue tanpa baca angka

**Why Auto-Refresh:**
- Real-time requirement → data harus update otomatis
- 30 detik balance antara freshness vs server load

### 5. Data Dummy

**File:** `web-irdc-gems/src/app/csms/data/evMonitoringData.js`

**Struktur:**
```javascript
{
  id: 1,
  unit_number: "EV-612",
  brand: "XCMG",
  fleet: "Fleet A",
  partner: "Partner 1",
  location: "Jakarta",
  soc: 43,           // State of Charge (%)
  soh: 88,           // State of Health (%)
  rpm: 0,
  speed_can: 0,      // km/h
  speed_gps: 0,
  pto_status: "Off",
  battery_temp: 28.5,
  battery_voltage: 385.2,
  battery_current: 0,
  battery_capacity: 282,
  status: "idle",
  soc_trend: [...],  // 15 hourly data points
  soh_trend: [...],  // 4 weekly data points
  alerts: [...]      // Warning/Error messages
}
```

**Why Dummy:**
- Backend belum ready (masih development)
- FE bisa parallel development
- Testing UI/UX tanpa depend backend
- Demo stakeholder untuk approval
- Tinggal swap API call nanti: `MOCK_EV_UNITS` → `fetchEVUnits()`

---

## Ticket 2: Efficiency Analysis Dashboard

### 1. Deskripsi Story Ticket
**Story:**
> As an admin, I want the system to calculate energy consumption efficiency for each trip based on SOC drop and distance, so I can benchmark units and identify inefficient driving patterns.

**Expected Results:**
- Calculate: `Efficiency Score = ΔSOC (%) / Distance (km)`
- Stored in trip log and linked to unit profile
- Dashboard: Per-unit efficiency graph over time
- Highlight trips above/below threshold (e.g., >4% per km = red)
- Filterable by: Date range, Unit, Route
- Optional: exportable report

### 2. Motivasi Stakeholder
**Kebutuhan bisnis:**
- **Benchmarking:** Compare efficiency antar unit → identifikasi unit yang boros vs hemat
- **Driver Behavior Analysis:** Trip inefficient bisa jadi karena driver ngebut, akselerasi kasar, atau route tidak optimal
- **Cost Optimization:** Unit efficient = charging cost lebih rendah = ROI lebih baik
- **Maintenance Planning:** Inefficiency trend bisa indikasi battery degradasi atau perlu service

**Use Case:**
> Analyst review weekly efficiency → EV-901 average 3.2% SOC/km (yellow), tapi EV-725 hanya 2.1% (green) di route yang sama → investigate: driver berbeda? Load berbeda? Battery EV-901 perlu check?

### 3. Solusi yang Dibuat

**Route:** `/csms/dashboard/efficiency-analysis`

**Komponen Utama:**

#### Tab 1: Trip List

**A. Filter System**
- Date range (start/end DatePicker)
- Unit selector
- Route dropdown (6 route options)
- Status filter (All, Efficient, Normal, Inefficient)
- Export CSV button

**B. Summary Cards**
- Total Trips
- Efficient Trips (green, <2% SOC/km)
- Normal Trips (yellow, 2-4% SOC/km)
- Inefficient Trips (red, >4% SOC/km)

**C. Trip Table (DataGrid)**
- Columns:
  - Trip ID
  - Unit, Brand, Route, Date
  - Distance (km)
  - ΔSOC (%)
  - **Efficiency (% SOC/km)** dengan icon & color
  - Status chip (Efficient/Normal/Inefficient)
  - Avg Speed, Driver
- Pagination (10/25/50/100 per page)
- Sortable columns

#### Tab 2: Unit Benchmark

**A. Bar Chart**
- Average efficiency per unit
- Visual comparison (lower is better)
- Y-axis: % SOC/km

**B. Unit Summary Cards**
- 5 cards (1 per unit)
- Show: Avg efficiency, Total trips, Total distance
- Color-coded border by status

**C. Per-Unit Efficiency Trend**
- 5 line charts (1 per unit)
- Last 10 trips
- X-axis: Date
- Y-axis: Efficiency

**Data File:** `data/tripEfficiencyData.js`
- 50 trip records
- 5 units (XCMG & HOWO)
- 6 routes dengan distance range realistic
- 5 drivers
- Efficiency auto-calculated: `ΔSOC / Distance`

### 4. Alasan Design

**Why 2 Tabs:**
- **Tab 1 (Trip List):** Ops team daily monitoring → "trip mana yang inefficient hari ini?"
- **Tab 2 (Benchmark):** Management weekly review → "unit mana yang paling hemat?"
- Separation of concerns: Detail vs Summary

**Why Threshold (2%, 4%):**
- Based on realistic EV truck consumption
- <2% = efficient (optimal driving, flat route)
- 2-4% = normal (average condition)
- >4% = inefficient (aggressive driving, hilly, atau anomali)

**Why Export CSV:**
- Stakeholder requirement: "exportable report"
- Excel analysis untuk deep dive
- Archive historical data

**Why Date Range Picker:**
- Filter trip per periode (daily, weekly, monthly report)
- Compare efficiency antar periode (bulan ini vs bulan lalu)

**Why Show Driver:**
- Identify inefficient driving pattern per driver
- Training/coaching driver yang boros

### 5. Data Dummy

**File:** `web-irdc-gems/src/app/csms/data/tripEfficiencyData.js`

**Struktur:**
```javascript
{
  id: 1,
  trip_id: "TRP-0001",
  unit_number: "EV-612",
  brand: "XCMG",
  route: "ROM A → Port Jakarta",
  driver: "Driver A",
  start_time: "2024-01-15 08:00:00",
  end_time: "2024-01-15 09:15:00",
  start_soc: 85,
  end_soc: 65,
  delta_soc: 20,       // start_soc - end_soc
  distance: 10.5,      // km
  efficiency: 1.90,    // delta_soc / distance
  status: "green",     // green/yellow/red based on threshold
  avg_speed: 45.3,
  weather: "Clear",
  load_weight: 15      // tons
}
```

**Data Generation Logic:**
- 50 trips random across last 30 days
- Distance based on route (realistic range per route)
- Efficiency calculated dengan formula: `base_efficiency (1.5-3.5) + variance`
- Status auto-assigned based on threshold
- Sorted by date (newest first)

**Why Dummy:**
- Backend trip logging belum ready
- Need realistic efficiency distribution (not all green/red)
- Formula-based → ada pattern (bukan random)
- Enough data untuk test pagination & filtering (50 trips)

---

## Ticket 3: Performance Analytics (Correlation Analysis)

### 1. Deskripsi Story Ticket
**Story:**
> As an Admin, I want to explore the relationship between operational parameters like RPM, speed, and SOC drop, so I can detect performance issues or optimize usage.

**Expected Results:**
- New backend module or export job
- Calculates correlations across parameters: RPM ↔ SOC Drop, Speed ↔ SOC Drop, RPM ↔ Speed
- Based on per-trip or per-minute logs
- Output: Heatmap / correlation matrix
- Threshold highlight (e.g., correlation > 0.6 marked strong)
- Used for root cause analysis or anomaly detection

### 2. Motivasi Stakeholder
**Kebutuhan bisnis:**
- **Root Cause Analysis:** Kenapa unit A boros? Karena RPM tinggi? Speed tinggi? Load berat?
- **Pattern Recognition:** Detect correlation yang tidak normal (e.g., high RPM tapi SOC drop rendah = battery issue?)
- **Optimization:** Jika Speed-SOC correlation tinggi → recommend speed limiter
- **Predictive Maintenance:** High Current-Temperature correlation → risk overheating → schedule cooling system check
- **Driver Training:** High RPM-SOC correlation → driver terlalu aggressive → training

**Use Case:**
> Data analyst investigate EV-612 boros → buka correlation matrix → lihat RPM-SOC correlation 0.85 (very strong, red) → conclusion: driver sering high RPM → recommend: driver behavior adjustment + governor setting

### 3. Solusi yang Dibuat

**Route:** `/csms/dashboard/performance-analytics`

**Komponen Utama:**

#### A. Unit Selector
- Dropdown pilih unit (5 options)
- Show brand di label

#### B. Correlation Matrix Heatmap (6x6 Table)
- **Parameters:** RPM, Speed, SOC Drop, Current, Temperature, Voltage
- Color-coded cells:
  - Red (strong ≥0.7)
  - Orange (moderate 0.4-0.7)
  - Yellow (weak 0.2-0.4)
  - Gray (very weak <0.2)
- Interactive: Click cell → update scatter plot
- Tooltip: Show correlation value + strength label
- Legend di bawah table

#### C. Scatter Plot
- **Dynamic X/Y Selector:** Dropdown untuk pilih parameter
- Show current correlation coefficient + strength chip
- 100 data points
- Responsive chart (Recharts ScatterChart)

#### D. Automated Insights Panel
- Auto-generate insights based on rules:
  - RPM-SOC >0.6 → "Potential over-torque battery stress"
  - Current-Temp >0.7 → "Monitor thermal management"
  - Current-SOC >0.7 → "Investigate battery efficiency"
  - Voltage-SOC anomaly (should be negative correlation)
- Show icon (Error/Warning/Info)
- Recommendation per insight
- Grid layout (2 columns)

#### E. Key Correlations Summary
- 6 pre-selected important pairs:
  - RPM ↔ SOC Drop
  - Speed ↔ SOC Drop
  - Current ↔ SOC Drop
  - Current ↔ Temperature
  - RPM ↔ Speed
  - Voltage ↔ SOC Drop
- Cards: Show correlation value + strength chip
- Click card → load in scatter plot

**Data File:** `data/performanceCorrelationData.js`
- 100 time-series data points per unit
- 6 parameters tracked
- Formula-based correlation (realistic patterns)
- Auto-calculate Pearson correlation coefficient
- Auto-generate insights per unit

### 4. Alasan Design

**Why Heatmap Matrix:**
- Visual instant: Red = strong, Gray = weak
- See all correlations sekaligus (6x6 = 36 combinations)
- Industry standard untuk correlation analysis
- Interactive → click to drill down

**Why Scatter Plot:**
- Validate correlation visually (lihat point distribution)
- Detect outliers
- Confirm linear/non-linear relationship
- R² value untuk confidence

**Why Automated Insights:**
- Stakeholder requirement: "detect performance issues"
- Non-technical user bisa paham (tidak perlu baca correlation matrix manual)
- Actionable recommendation → langsung tahu harus apa

**Why 6 Parameters:**
- Balance: Enough untuk meaningful analysis, tidak overwhelming
- Core operational params yang affect efficiency:
  - **RPM:** Engine load indicator
  - **Speed:** Route/driving behavior
  - **SOC Drop:** Energy consumption
  - **Current:** Power draw (high current = high consumption)
  - **Temperature:** Thermal stress indicator
  - **Voltage:** Battery health indicator

**Why Per-Unit (bukan aggregate):**
- Each unit punya characteristic berbeda (brand, age, usage pattern)
- Anomaly detection lebih akurat per unit
- Benchmarking: Compare unit A vs unit B correlation patterns

### 5. Data Dummy

**File:** `web-irdc-gems/src/app/csms/data/performanceCorrelationData.js`

**Struktur:**
```javascript
{
  unit_number: "EV-612",
  brand: "XCMG",
  data: [
    {
      timestamp: "2024-01-15 14:00:00",
      rpm: 1250,
      speed: 45,
      soc_drop: 2.3,     // % per minute
      current: 120,       // A
      temp: 35.2,         // °C
      voltage: 385.5      // V
    },
    // ... 99 more points
  ],
  correlation_matrix: {
    rpm: { rpm: 1.0, speed: 0.65, soc_drop: 0.72, ... },
    speed: { rpm: 0.65, speed: 1.0, soc_drop: 0.58, ... },
    // ... full 6x6 matrix
  }
}
```

**Data Generation Logic (Formula-Based):**
```javascript
// Realistic correlations:
soc_drop = 0.5 * (rpm/2000) + 0.4 * (speed/70) + 0.3 * (current/200) + noise
temp = 60 * (current/200) + 30 * (rpm/2000) + noise
voltage = 400 - (soc_drop * 3) + noise
```

**Why Formula-Based (bukan random):**
- Random data → correlation ~0 (useless)
- Formula create realistic positive/negative correlations
- Noise added untuk variance (not perfect correlation)
- Pearson coefficient auto-calculated dari generated data

**Insights Auto-Generation:**
- Loop through correlation matrix
- Apply threshold rules (>0.6, >0.7, etc.)
- Flag anomalies (e.g., expected negative correlation jadi positive)
- Generate recommendation text based on category

**Why Dummy:**
- Backend per-minute logging belum ada
- Correlation calculation engine backend belum ready
- 100 points per unit cukup untuk statistical significance
- FE siap, tinggal ganti data source nanti

---

## Technical Notes

### File Structure
```
web-irdc-gems/src/app/csms/
├── navigation.js                          (updated - 4 dashboard sub-menus)
├── config.js                              (updated - 3 new routes)
├── data/
│   ├── evMonitoringData.js               (Ticket 1 - EV metrics)
│   ├── tripEfficiencyData.js             (Ticket 2 - Trip logs)
│   └── performanceCorrelationData.js     (Ticket 3 - Correlation data)
└── features/
    └── dashboard/
        ├── ChargingPileDashboardPage.jsx  (existing)
        ├── EVBatteryMonitoringPage.jsx    (Ticket 1)
        ├── EfficiencyAnalysisPage.jsx     (Ticket 2)
        └── PerformanceAnalyticsPage.jsx   (Ticket 3)
```

### Navigation Structure
```
CSMS Sidebar
└── Dashboard (collapse)
    ├── Station Monitoring          (existing - charging pile status)
    ├── EV Battery Monitoring       (Ticket 1 - /csms/dashboard/ev-monitoring)
    ├── Efficiency Analysis         (Ticket 2 - /csms/dashboard/efficiency-analysis)
    └── Performance Analytics       (Ticket 3 - /csms/dashboard/performance-analytics)
```

### Libraries Used
- **@mui/material** - UI components (Table, Card, Dialog, Chip, etc.)
- **@mui/x-data-grid** - DataGrid untuk table
- **@mui/x-date-pickers** - DatePicker untuk filter
- **recharts** - Charts (LineChart, BarChart, ScatterChart)

### Data Migration Path (Dummy → Real API)

**Current (Dummy):**
```javascript
import { MOCK_EV_UNITS } from "../../data/evMonitoringData";
const [units, setUnits] = useState(MOCK_EV_UNITS);
```

**Future (Real API):**
```javascript
import { fetchEVUnits } from "../../services/api/evService";

useEffect(() => {
  const loadData = async () => {
    const data = await fetchEVUnits();
    setUnits(data);
  };
  loadData();
}, []);
```

Tinggal swap 1 line per dashboard, logic & UI tetap sama.

---

## Summary

| Ticket | Route | Purpose | Key Features | Dummy Data Size |
|--------|-------|---------|--------------|-----------------|
| **Ticket 1** | `/csms/dashboard/ev-monitoring` | Real-time EV monitoring | Table view, Detail modal, SOC/SOH charts, Alerts | 5 units, 15 trend points each |
| **Ticket 2** | `/csms/dashboard/efficiency-analysis` | Trip efficiency benchmarking | Trip list, Unit comparison, Trend charts, Export CSV | 50 trips, 5 units |
| **Ticket 3** | `/csms/dashboard/performance-analytics` | Correlation analysis | Heatmap matrix, Scatter plot, Auto insights | 100 time-series points per unit |

**Total LOC:** ~1,500 lines (3 pages + 3 data files)

**Development Time:** ~4-6 hours (design, implementation, testing)

**Ready for:** Stakeholder demo, UI/UX testing, API integration planning

---

## Next Steps (API Integration)

1. **Backend Team:**
   - Develop REST endpoints: `/api/ev-units`, `/api/trips`, `/api/performance-logs`
   - Implement efficiency calculation logic
   - Implement correlation calculation engine (Pearson coefficient)
   - Setup WebSocket untuk real-time updates (EV monitoring)

2. **Frontend Team:**
   - Create API service files (`evService.js`, `tripService.js`, `performanceService.js`)
   - Replace dummy imports with API calls
   - Add loading states & error handling
   - Add retry logic untuk failed requests

3. **QA Testing:**
   - Test dengan real data volume (1000+ trips, 50+ units)
   - Performance testing (table pagination, chart rendering)
   - Cross-browser testing
   - Mobile responsive testing

---

**Document Version:** 1.0
**Last Updated:** 2025-01-18
**Author:** Development Team
